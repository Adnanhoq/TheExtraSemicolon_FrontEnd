{% extends "./layouts/main.njk" %}

    {% block pageTitle %}
        Update Profile Picture
    {% endblock %}

    {% block scripts %}
    <script type="text/javascript" src="https://unpkg.com/webcam-easy/dist/webcam-easy.min.js"></script>
    {% endblock %}

{% block content %}

<dialog id="dialog">
    <div>
        <h2>Accept your new profile picture?</h2>
     <svg id="thumbnail" class="rounded-circle" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="500" height="500"></svg>
    <form action="/profile" method="post">
    <input type="hidden" name="profile" id="profile"/>
    <div class="mt-4">
    <button class="btn btn-danger" type="button" id="cancel">Cancel</button>
    <button class="btn btn-success" type="submit">Accept</button>
    <div>
    </form>
    </div>
</dialog>

<div class="d-flex justify-content-center">
<div class="d-flex flex-column justify-content-center">
<h2 class="mb-2">Update your profile picture:</h2>
<video id="webcam" autoplay playsinline class="rounded-circle" width="500" height="500"></video>
<canvas id="canvas" class="d-none"></canvas>
<div class="d-flex w-100 justify-content-center">
<button class="mt-3 btn btn-secondary w-50" id="takePicture">Take Picture</button>
</div>
</div>
</div>

<script>

const webcamElement = document.getElementById('webcam');
const canvasElement = document.getElementById('canvas');
const dialog = document.getElementById("dialog");
const snapSoundElement = document.getElementById('snapSound');
const webcam = new Webcam(webcamElement, 'user', canvasElement, snapSoundElement);
const cancelButton = document.getElementById('cancel');

webcam.start()
   .then(result =>{
      console.log("webcam started");
   })
   .catch(err => {
       console.log(err);
   });

document.getElementById('takePicture').addEventListener('click', takePicture);

function takePicture() {
    var image = webcam.snap();
    console.log(image);
    var svgimg = document.createElementNS("http://www.w3.org/2000/svg", "image");
    svgimg.setAttributeNS("http://www.w3.org/1999/xlink", 'xlink:href', image);

    document.getElementById("thumbnail").appendChild(svgimg);
    //document.getElementById("profile").appendChild(svgimg);
    dialog.showModal();
}


document.getElementById('cancel').addEventListener('click',
() => dialog.close());



webcam.stop();


</script>
{% endblock %}